

# ğŸŒŸ **JWT + Role-Based Authorization (ADMIN / USER)**

**Goal:**
Students will learn how to protect APIs based on roles like:

* **ROLE_ADMIN**
* **ROLE_USER**

This is the real industry-level security.

---

# ğŸŸ¦ **1. What Students Already Know (From Day 10)**

Students should already know:

âœ” How JWT token works
âœ” How to generate a JWT
âœ” How to validate a JWT
âœ” Token stored in Authorization header

Now we add **roles** to control permissions.

---

# ğŸŸ§ **2. What is Role-Based Authorization? (Beginner Explanation)**

Every user has a **role**.

Example:

* Admin â†’ full access
* User â†’ limited access

We protect APIs like this:

| API       | Who Can Access?     |
| --------- | ------------------- |
| /admin    | Only ADMIN          |
| /user     | USER + ADMIN        |
| /products | Anyone (permit all) |

---

# ğŸŸ¥ **3. Create User Entity with Roles**

### User.java

```java
@Entity
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private int id;

    private String username;
    private String password;

    private String role;  // ROLE_ADMIN or ROLE_USER
}
```

---

# ğŸŸª **4. UserRepository**

```java
public interface UserRepository extends JpaRepository<User, Integer> {
    User findByUsername(String username);
}
```

---

# ğŸŸ« **5. During Login â†’ Add Role to JWT Token**

The role is added inside JWT as a **claim**.

### JWTService.java (updated)

```java
public String generateToken(UserDetails userDetails, String role) {
    Map<String, Object> claims = new HashMap<>();
    claims.put("role", role);

    return createToken(claims, userDetails.getUsername());
}
```

---

# ğŸŸ¦ **6. Extract Role from JWT Token (While Validating)**

Add:

```java
public String extractRole(String token) {
    return extractClaim(token, claims -> claims.get("role").toString());
}
```

---

# ğŸŸ§ **7. Spring Security Configuration for Roles**

### SecurityConfig.java

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Autowired
    private JwtFilter jwtFilter;

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {

        http.csrf().disable()
            .authorizeHttpRequests()
            .requestMatchers("/auth/login", "/auth/register").permitAll()  // public
            .requestMatchers("/admin/**").hasRole("ADMIN")   // only admin
            .requestMatchers("/user/**").hasAnyRole("USER", "ADMIN") // user or admin
            .anyRequest().authenticated()
            .and()
            .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);

        http.addFilterBefore(jwtFilter, UsernamePasswordAuthenticationFilter.class);

        return http.build();
    }
}
```

**Key points:**

* `.hasRole("ADMIN")` â†’ only admin
* `.hasAnyRole("USER","ADMIN")` â†’ both can access
* `.permitAll()` â†’ public

---

# ğŸŸ¥ **8. Update JwtFilter to Set Role into Security Context**

Inside `doFilterInternal()`:

```java
String role = jwtService.extractRole(token);

UsernamePasswordAuthenticationToken authToken =
        new UsernamePasswordAuthenticationToken(username, null, 
                Collections.singleton(new SimpleGrantedAuthority("ROLE_" + role)));
```

This tells Spring Security â†’ â€œuser has this roleâ€.

---

# ğŸŸ¦ **9. Create APIs Based on Roles**

### AdminController.java

```java
@RestController
@RequestMapping("/admin")
public class AdminController {

    @GetMapping("/dashboard")
    public String adminDashboard() {
        return "Welcome Admin!";
    }
}
```

### UserController.java

```java
@RestController
@RequestMapping("/user")
public class UserController {

    @GetMapping("/profile")
    public String userProfile() {
        return "Welcome User!";
    }
}
```

### PublicController.java

```java
@RestController
public class PublicController {

    @GetMapping("/welcome")
    public String welcome() {
        return "Welcome to Public API!";
    }
}
```

---

# â­ **10. Register Users with Role**

### Registration JSON

```json
{
  "username": "kumar",
  "password": "12345",
  "role": "ROLE_USER"
}
```

```json
{
  "username": "admin",
  "password": "admin123",
  "role": "ROLE_ADMIN"
}
```

---

# ğŸ§ª **11. Testing**

### Login as Admin â†’ get JWT

Try:

```
GET /admin/dashboard
```

Works âœ”
Try:

```
GET /user/profile
```

Works âœ” (admin also has access)

---

### Login as User â†’ get JWT

Try:

```
GET /user/profile
```

Works âœ”
Try:

```
GET /admin/dashboard
```

âŒ Access Denied â†’ This is correct

---

# ğŸ“ **12.Assignments for Students**

### **Task 1:**

Add a new role **ROLE_MANAGER**

Allow:

* /manager/** â†’ only manager
* /admin/** â†’ admin + manager
* /user/** â†’ user + manager + admin

---

### **Task 2:**

Create ManagerController:

```java
GET /manager/report
```

---

### **Task 3:**

Add multiple roles to a User (Extra challenge)

Convert:

```
private String role;
```

to:

```
private List<String> roles;
```

