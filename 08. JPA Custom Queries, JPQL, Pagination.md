

# ğŸŒŸ **JPA: Custom Queries, JPQL, Pagination**

**Goal:** Students learn how to write custom queries and handle large data using pagination.

---

# ğŸŸ¦ **1. What is Derived Query? (Beginner Explanation)**

Spring can create SQL automatically based on **method names**.

Example:

Repository:

```java
List<Student> findByCity(String city);
```

Spring generates SQL:

```sql
SELECT * FROM student WHERE city = ?
```

---

# ğŸŸ© **2. Examples of Derived Queries**

Repository:

```java
List<Student> findByName(String name);
List<Student> findByCity(String city);
List<Student> findByAgeGreaterThan(int age);
List<Student> findByAgeBetween(int a, int b);
List<Student> findByNameStartingWith(String prefix);
```

---

# ğŸŸ§ **3. Writing Custom JPQL Queries (@Query)**

JPQL = Java Persistence Query Language
Uses **Java class names**, not table names.

Example:

```java
@Query("select s from Student s where s.city = ?1")
List<Student> getByCity(String city);
```

---

# ğŸŸ¥ **4. Native SQL Query**

Use real SQL inside @Query.

```java
@Query(value="SELECT * FROM student WHERE city=?1", nativeQuery=true)
List<Student> fetchByCity(String city);
```

---

# ğŸŸ¦ **5. UPDATE Query With @Modifying**

Used for update/delete operations.

```java
@Modifying
@Transactional
@Query("update Student s set s.city=?2 where s.id=?1")
int updateCity(int id, String city);
```

---

# ğŸŸ¨ **6. Pagination (Beginner Explanation)**

Used when database has **thousands of records**.

Import:

```java
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
```

### Controller Example:

```java
@GetMapping("/students")
public Page<Student> getStudents(@RequestParam int page, @RequestParam int size) {
    Pageable pageable = PageRequest.of(page, size);
    return repo.findAll(pageable);
}
```

### Test:

```
GET /students?page=0&size=5
```

---

# â­ **7. Sorting**

```java
Pageable pageable = PageRequest.of(page, size, Sort.by("name").ascending());
return repo.findAll(pageable);
```

---

# ğŸŸ« **8. Mini Project**

### For Student table:

Create these repository methods:

```java
List<Student> findByCity(String city);
List<Student> findByNameStartingWith(String prefix);

@Query("select s from Student s where s.age > ?1")
List<Student> ageGreater(int age);
```

Create API endpoints to call them:

```
GET /students/city/{city}
GET /students/name/{prefix}
GET /students/age/{age}
```

---

# ğŸ“ **9.Assignments**

### **Task 1 â€“ Employee Queries**

Create:

* findByDepartment
* findBySalaryGreaterThan
* findBySalaryBetween

Create APIs for each query.

---

### **Task 2 â€“ Pagination**

Implement:

```
GET /employees?page=0&size=3
```

Return paginated data.
